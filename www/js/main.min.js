var app={app_context:this,initialize:function(){this.bindEvents(),window.firstTime=!0,window.apiRH=(new requestHandlerAPI).construct(app),this.registerHelpers();var e=apiRH.has_token(),t="undefined"!=typeof window.is_home?window.is_home:!0;localStorage.getItem("customerId"),localStorage.getItem("valido");if(window.cordova_full_path="",window.catalogues=[],window.catalogues.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],window.catalogues.coach_type=["Estricto","Innovador","Animador","Tradicional"],window.catalogues.restricciones=["Huevo","Pollo","Pescado","Mariscos","Lacteos","Carne"],window.catalogues.objetivo=["adelgazar","detox","bienestar","rendimiento"],window.catalogues.sex=["Hombre","Mujer"],window.catalogues.tipo_de_ingredientes=["granosycereales","verduras","grasas","lacteos","proteinaanimal","leguminosas","nuecesysemillas","frutas","endulzantes","aderezosycondimentos","superfoods","liquidos"],window.loggedIn=!1,this.keeper=window.localStorage,!e)return app.render_login();console.log("You okay, now you can start making calls"),loggedIn=!0;var n=JSON.parse(localStorage.getItem("user"));return window._coach=n?n:"",t?app.render_home():void 0},initPushNotifications:function(){console.log("Initilizing push notifications service");var e=function(e){console.log("notificationOpenedCallback: "+JSON.stringify(e))};window.plugins.OneSignal.startInit("d4e8ad62-1f9d-45f8-8905-3d152b7c1b7d").handleNotificationOpened(e).endInit()},registerCompiledPartials:function(){console.log("Register pre compiled partials");var e=["header","loader"];e.forEach(function(e){Handlebars.registerPartial(e,Handlebars.templates[e])})},registerTemplate:function(e){$.ajax({url:cordova_full_path+"views/"+e+".hbs",success:function(t){void 0===Handlebars.templates&&(Handlebars.templates={}),Handlebars.templates[e]=Handlebars.compile(t)}})},registerHelpers:function(){Handlebars.registerHelper("if_eq",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("if_module",function(e,t,n){return e%t==0?n.fn(this):n.inverse(this)})},bindEvents:function(){document.addEventListener("deviceready",app.onDeviceReady,!1),document.addEventListener("mobileinit",app.onDMobileInit,!1)},onBackButton:function(){var e=navigator.userAgent||navigator.vendor||window.opera;e.match(/iPad/i)||e.match(/iPhone/i)||e.match(/iPod/i)?history.go(-1):e.match(/Android/i)?navigator.app.backHistory():history.go(-1),console.log("BAck")},onDeviceReady:function(){app.receivedEvent("deviceready"),window.cordova_full_path="undefined"!=typeof cordova?cordova.file.applicationDirectory+"www/":"";try{OAuth.initialize("7-ipR3QS-__wrorRTpdedM8-_v8"),console.log("Initialized Oauth")}catch(e){app.toast("Oauth error ocurred"),console.log("OAuth initialize error: "+e)}try{app.initPushNotifications()}catch(e){app.toast("Push notifications error: "+JSON.stringify(e))}var t=document.getElementById("backBtn");t&&t.addEventListener("click",app.onBackButton,!1)},onMobileInit:function(){app.receivedEvent("mobileinit"),console.log("mobileinit")},receivedEvent:function(e){"deviceready"==e&&"undefined"!=typeof navigator.splashscreen&&navigator.splashscreen.hide()},getJsonCatalogue:function(e){var t=$.getJSON("compiled/catalogues/"+e+".json");return JSON.parse(t.responseText)},gatherEnvironment:function(e,t){var n=this.keeper.getItem("user"),o={me:JSON.parse(n)};return e&&(o.data=e),t&&(o.header_title=t),"undefined"!=typeof cordova_full_path&&""!=cordova_full_path&&(o.cordova_full_path=cordova_full_path),o},getUrlVars:function(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,o){e[n]=o});return e},getFormData:function(e){return $(e).serializeJSON()},isObjEmpty:function(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},check_or_renderContainer:function(){if(window.firstTime){console.log("Rendering first time");var e=Handlebars.templates.container,t=e();$(".rootContainer").html(t)}},render_template:function(e,t,n){window.is_home=!1;var o=Handlebars.templates[e];if(!o)return console.log("Template doesn't exist"),!1;var i=this.gatherEnvironment(n);i.is_scrollable=!1,$(t).append(o(i))},render_login:function(e){window.is_home=!1,app.showLoader(),app.check_or_renderContainer();var t=this.gatherEnvironment();return t.is_scrollable=!1,this.switchView("login",t,".view",e,"login")},render_home:function(e){console.log("Render home"),window.is_home=!0,app.showLoader(),app.check_or_renderContainer();var t=this.gatherEnvironment();return t.is_scrollable=!1,this.switchView("home",t,".view",e,"home-menu",!1,!1)},render_user_list:function(e){var t=[];window.is_home=!1,app.check_or_renderContainer();var n=this.gatherEnvironment(t,"Usuarios");return this.switchView("user-list",n,".view",e,"list-usuarios")},render_chat:function(e){var t=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var n=this.gatherEnvironment(t,"Chat");return this.switchView("chat-contacts",n,".view",e,"has-chat-list",!0)},render_chat_dialog:function(e,t){var n=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var o=this.gatherEnvironment(n,"Chat"),i=t?"dialogLoad":"";return window.dialogNow=t?t:null,this.switchView("chat-dialog",o,".view",e,"list-chat dialog_detail "+i)},render_finanzas_view:function(e){var t=[];t.total_amount=0,t.total_days=0,window.is_home=!1;var n=new Date,o=n.getMonth();setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer(),t.clients=apiRH.getFinanzas(o),t.this_month=catalogues.months[o],t.this_day=n.getDate(),t.clients.forEach(function(e){t.total_amount+=e.amount_this_month,t.total_days+=e.days_this_month,e.amount_this_month=Math.round(100*e.amount_this_month)/100}),t.total_amount=Math.round(100*t.total_amount)/100,console.log(t);var i=this.gatherEnvironment(t,"Finanzas");return this.switchView("finanzas",i,".view",e,"finanzas")},render_finanzas:function(e,t,n){var o=[];o.total_amount=0,o.total_days=0;var i=new Date;setTimeout(function(){app.showLoader()},800),o.clients=apiRH.getFinanzas(t),o.this_month=catalogues.months[t],o.this_day=i.getDate(),o.clients.forEach(function(e){o.total_amount+=Math.round(100*e.amount_this_month)/100,o.total_days+=e.days_this_month,e.amount_this_month=Math.round(100*e.amount_this_month)/100}),o.total_amount=Math.round(100*o.total_amount)/100,console.log(o);var a=this.gatherEnvironment(o,"Finanzas");return this.switchView("finanzas",a,".view",e,"finanzas",!1,!1)},render_coach_dietas:function(e){var t=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var n=this.gatherEnvironment(t,"Dietas");return this.switchView("diet-list",n,".view",e,"diet-list")},render_dietas_content:function(e){var t=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer(),t=apiRH.getDiets();var n=this.gatherEnvironment(t,"Dietas");return this.switchView("diet-list",n,".view",e,"diet-list")},render_create_diet:function(e){var t=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var n=this.gatherEnvironment(t,"Dietas");return console.log(n),this.switchView("create-diet",n,".view",e,"create-new-diet")},render_duplicate_diet:function(e){},render_myProfile:function(e){var t=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var t=apiRH.fetchCoachProfile(),n=this.gatherEnvironment(t,"Mi Perfil");return console.log(n),this.switchView("coach",n,".view",e,"coach-profile")},render_clientProfile:function(e,t){var n=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var n=apiRH.fetchClientProfile(t),o=this.gatherEnvironment(n,"");return console.log(o),this.switchView("user-profile",o,".view",e,"has-user")},render_comingSoon:function(e){var t=[];window.is_home=!1,setTimeout(function(){app.showLoader()},800),app.check_or_renderContainer();var n=this.gatherEnvironment(t,"Pr√≥ximamente");return this.switchView("coming-soon",n,".view",e,"coming-soon")},get_file_from_device:function(e,t){apiRH.getFileFromDevice(e,t)},showLoader:function(){$("#spinner").show()},hideLoader:function(){$("#spinner").hide()},toast:function(e,t){try{t?window.plugins.toast.showLongBottom(e):window.plugins.toast.showLongCenter(e)}catch(n){console.log("Toasting error: "+JSON.stringify(n)),alert(e)}},switchView:function(e,t,n,o,i,a,r){o&&window.history.pushState(e,e,"/"+o),r="undefined"!=typeof r?r:!0;var s=Handlebars.templates[e];return s?($(n).fadeOut(360,function(){i&&$(n).attr("class","view").addClass(i),r?$(n).html(s(t)).css("opacity",1).css("display","block").css("margin-left","20px").animate({"margin-left":"0",opacity:1},360):$(n).html(s(t)).css({opacity:0,display:"block"}).animate({opacity:1},640)}),a?setTimeout(function(){window.firstTime&&(window.firstTime=!1),initializeEvents()},2e3):setTimeout(function(){window.firstTime&&(window.firstTime=!1),app.hideLoader(),initializeEvents()},2e3)):(console.log("Template doesn't exist"),!1)},register_activity:function(e,t,n,o){var i={method:"post",url:api_base_url+"tables/medicion/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":"","Content-Type":"application/json"},data:{tipo:e,magnitud:t,cliente:n,coach:o}};$http(i).success(function(e){console.log(e)})},update_perfil:function(e,t,n,o,i,a,r,s,c,l,d,u,h){var p={method:"post",url:api_base_url+"tables/medicion/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":"","Content-Type":"application/json"},data:{sexo:e,peso:t,pesoDeseado:n,personalidad:o,objetivo:i,ejercicio:a,edad:r,fechaNacimiento:s,cp:c,comentarios:l,nombre:d,restricciones:u,estatura:h}};$http(p).success(function(e){console.log(e)})},update_platillo:function(e,t,n,o){var i={method:"post",url:api_base_url+"tables/consumo/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":"","Content-Type":"application/json"},data:{plato:dishID,fecha:t,comida:n,platillo:o}};$http(i).success(function(e){console.log(e)})},get_diet:function(e){var t={method:"GET",url:api_base_url+"tables/dieta/"+e,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":localStorage.getItem("token"),"Content-Type":"application/json"}};return $.ajax({type:"GET",headers:t.headers,url:t.url,dataType:"json",async:!1}).done(function(e){result=e,localStorage.setItem("dieta",e),sdk_app_context.hideLoader(e)}).fail(function(e){result=!1,console.log(JSON.stringify(e))}),result},restaFechas:function(e,t){var n=e.split("-"),o=t.split("/"),i=Date.UTC(n[2],n[1]-1,n[0]),a=Date.UTC(o[2],o[1]-1,o[0]),r=a-i,s=Math.floor(r/864e5);return s}};jQuery(document).ready(function(e){window.number_format=function(e,t){if(e+="",e=parseFloat(e.replace(/[^0-9\.]/g,"")),t=t||0,isNaN(e)||0===e)return parseFloat(0).toFixed(t);e=""+e.toFixed(t);for(var n=e.split("."),o=/(\d+)(\d{3})/;o.test(n[0]);)n[0]=n[0].replace(o,"$1,$2");return n.join(".")},e("#send_fPago").on("click",function(){var t=e('input[name="nombre"]').val(),n=e('input[name="card"]').val(),o=e('input[name="mes"]').val(),i=e('input[name="year"]').val(),a=e('input[name="cvc"]').val();e('input[name="mail"]').val(),e('input[name="cupon"]').val(),e('input[name="terms"]').val();Conekta.setPublishableKey("key_C3MaVjaR7emXdiyRGTcbjFQ");var r,s,c;c={card:{number:n,name:t,exp_year:i,exp_month:o,cvc:a}},s=function(e){var t=apiRH.makePayment(e.id);if(t){var t=(localStorage.setItem("coachId"),localStorage.setItem("dietaId"),apiRH.updatePerfil(JSON));t?window.location.assign("dieta.html"):alert("Error al actualizar datos")}else alert("Error al procesar tu pago")},r=function(e){return console.log(e.message)},Conekta.token.create(c,s,r)}),e(".main").on("tap",".each_notification a",function(t){t.preventDefault();var n=(e(this).attr("href"),e(this));if(n.hasClass("read"))return!1;var o=n.data("id"),i=apiRH.makeRequest(user+"/notifications/read/"+o);i&&n.addClass("read")}),e(document).on("tap","#load_more_posts",function(t){t.preventDefault();var n=e(this).data("page");app.get_user_timeline(n),t.stopPropagation()}),e(document).on("tap","#load_more_results",function(t){t.preventDefault();var n=e(this).data("page"),o=app.getUrlVars();app.get_search_results(o.searchbox,n),t.stopPropagation()})});