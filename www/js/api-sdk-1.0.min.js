function requestHandlerAPI(){this.token=null,this.upload_ready=!1,this.version="1.3",this.app_build="1.3.2",this.device_model="undefined"!=typeof device?device.model:"not set",this.device_platform="undefined"!=typeof device?device.platform:"not set",this.device_platform_version="undefined"!=typeof device?device.version:"not set",this.device_info={sdk_version:this.version,build:this.app_build,model:this.device_model,platform:this.device_platform,version:this.device_platform_version},this.keeper=window.localStorage,this.headers={"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":this.keeper.getItem("token"),"Content-Type":"application/json"};var e=this;window.api_base_url="https://gingerservice.azure-mobile.net/",window.sdk_app_context=null,this.construct=function(e){return this.keeper.getItem("request_token")&&(this.token=this.keeper.getItem("request_token")),sdk_app_context=e,this},this.loginNative=function(e){var t=e.mail,i=e.pass,a={method:"post",url:api_base_url+"api/login",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":"","Content-Type":"application/json"},data:{tipo:"coach",mail:t,password:i}},o=this.makeRequest("api/login",a);if("FAIL"==o.Status)return!1;apiRH.keeper.setItem("token",o.token),apiRH.keeper.setItem("mail",o.mail),apiRH.keeper.setItem("userId",o.userId),this.token=o.token;var n=(apiRH.keeper.getItem("userId"),apiRH.keeper.getItem("mail"),apiRH.keeper.getItem("token"));return n?this.token:!1},this.getDiets=function(){var e=this.getRequest("tables/dieta?min=true&coach="+apiRH.keeper.getItem("userId"),null);return console.log("RESPONSE DIET ::: "+JSON.stringify(e)),setTimeout(function(){sdk_app_context.hideLoader()},2e3),e?e:!1},this.updateDiet=function(e){var t={method:"PATCH",url:api_base_url+"tables/dieta/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e};console.log(JSON.stringify(t));var i=this.patchRequest("tables/dieta/",e);return console.log("Request Path Data Dieta"),console.log(i),i?i:!1},this.deleteDiet=function(e){var t={method:"DELETE",url:api_base_url+"tables/dieta/"+e,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"}};console.log(JSON.stringify(t));var i=this.deleteRequest("tables/dieta/"+e,t);return console.log(i),i?i:!1},this.deleteDish=function(e){var t={method:"DELETE",url:api_base_url+"tables/dieta/"+e,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"}};console.log(JSON.stringify(t));var i=this.deleteRequest("tables/dieta/"+e,t);return console.log(i),i?i:!1},this.copyDiet=function(e){var t={method:"POST",url:api_base_url+"api/duplicate",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e};console.log(JSON.stringify(t));var i=this.makeRequest("api/duplicate",t);return console.log("Request Copy Data Dieta"),console.log(i),i?i:!1},this.createDiet=function(e){var t={method:"POST",url:api_base_url+"api/create",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e};console.log(JSON.stringify(t));var i=this.makeRequest("api/duplicate",t);return console.log("Request Copy Data Dieta"),console.log(i),i?i:!1},this.makeDiet=function(e){var t={method:"POST",url:api_base_url+"tables/dieta/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:JSON.parse(e)};console.log(JSON.stringify(t));var i=this.makeRequest("tables/dieta/",t);return console.log("Request Copy Data Dieta"),console.log(i),i?i:!1},this.saveDiet=function(e){var t=JSON.parse(e);console.log(t.__v),delete t.__v,e=JSON.stringify(t);var i={method:"PATCH",url:api_base_url+"tables/dieta/"+JSON.parse(e)._id,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e};console.log(i.data),console.log(i);var a=this.patchRequest("tables/dieta/"+JSON.parse(e)._id,i);return console.log("Request PATCH Data Dieta"),console.log("RESPUESTA DEL SERVIDOR: "+JSON.stringify(a)),a?a:!1},this.listDishes=function(e){var t=this.getRequest("tables/plato?coach="+apiRH.keeper.getItem("userId")+"&publico="+e,null);return console.log("Request Data Dishes"+JSON.stringify(t)),t?t:!1},this.makeDish=function(e){var t={method:"post",url:api_base_url+"tables/plato",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e};console.log(t);var i=this.makeRequest("tables/plato",t);return console.log("Request Data Cliente"),console.log(i),i?i:!1},this.listIngredient=function(){var e=this.getRequest("tables/ingrediente/?epp=999",null);return console.log("Request Data Ingredients"+JSON.stringify(e)),e?e:!1},this.newIngredient=function(e){var t={method:"post",url:api_base_url+"tables/ingrediente",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e},i=this.makeRequest("tables/ingrediente",t);return console.log("RESPONSE INGREDIENTS :::: "+i),i?i:!1},this.getUsuarios=function(){var e=this.getRequest("api/client_status?coachid="+apiRH.keeper.getItem("userId"),null);return e?e:!1},this.updateClientDiet=function(e,t){var i={method:"PATCH",url:api_base_url+"tables/cliente/"+e,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:t},a=this.makePatch2Request("tables/cliente/"+e,i);return console.log("Response Update Client Diet: "+JSON.stringify(a)),apiRH.keeper.setItem("carry-user",JSON.stringify(a)),a?a:!1},this.getFinanzas=function(e){var t=this.getRequest("api/history/?coach="+apiRH.keeper.getItem("userId")+"&mes="+e,null);return console.log("Response Finanzas ::: "+JSON.stringify(t)),t?t:!1},this.getInfoCoach=function(){var e=this.getRequest("tables/coach?_id="+apiRH.keeper.getItem("userId"),null);return this.save_user_data_clientside(JSON.stringify(e)),e?!0:!1},this.updatePerfil=function(e){var t={method:"PATCH",url:api_base_url+"tables/cliente/"+apiRH.keeper.getItem("userId"),headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:e};console.log(JSON.stringify(t));var i=this.patchRequest("tables/cliente/"+apiRH.keeper.getItem("userId"),t);return console.log("Request Path Data Cliente"),console.log(i),i?i:!1},this.makePayment=function(e){var t={method:"POST",url:api_base_url+"api/history/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":apiRH.keeper.getItem("token"),"Content-Type":"application/json"},data:{cliente:apiRH.keeper.getItem("userId"),card_token:e}};console.log(t);var i=this.makeRequest("api/history",t);return console.log("Request Data Cliente"),console.log(i),"OK"==i.statusText?!0:!1},this.registerUpTake=function(e){var t={method:"post",url:api_base_url+"tables/medicion/",headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":this.token,"Content-Type":"application/json"},data:{}},i=this.makeRequest("tables/consumos",t);return console.log(i),i?i:!1},this.updateUserSetting=function(e){var t={method:"patch",url:api_base_url+"tables/cliente/"+e._id,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":this.token,"Content-Type":"application/json"},data:{}},i=this.makeRequest("tables/cliente/"+e._id,t);return console.log(i),i?i:!1},this.getPaymentAccount=function(e){var t={method:"patch",url:api_base_url+"api/history/"+e._id,headers:{"X-ZUMO-APPLICATION":"ideIHnCMutWTPsKMBlWmGVtIPXROdc92","X-ZUMO-AUTH":this.token,"Content-Type":"application/json"},data:{}},i=this.makeRequest("api/history/"+e._id,t);return console.log(i),i?i:!1},this.getUserId=function(){var e=JSON.parse(apiRH.keeper.getItem("carry-user")),t=this.getRequest("tables/cliente?_id="+e._id,req);return console.log("Response Data Clientes ::: "+t),t?t:!1},this.save_user_data_clientside=function(e){apiRH.keeper.setItem("user",e)},this.request_token=function(){var e=this.getRequest("api/",null);return e.success!==!1?(this.token=e.data.request_token,this.keeper.setItem("request_token",e.data.request_token),this):this},this.set_user_token=function(){},this.execute=function(e,t,i){return"POST"===e?this.makeRequest(t,i):"GET"===e?this.getRequest(t,i):"PUT"===e?this.putRequest(t,i):void 0},this.has_token=function(){return"undefined"!=typeof this.token||""!==this.token?apiRH.keeper.getItem("token"):!1},this.has_valid_token=function(){if(void 0!==this.token||""!==this.token){console.log("Looks like you already have a token, let's check if it is valid");var e=void 0!=typeof this.keeper.getItem("dedalo_log_info")?JSON.parse(this.keeper.getItem("dedalo_log_info")):null;if(!e)return!1;var t=e.user_id,i={user_id:t,request_token:apiRH.get_request_token(),device_info:this.device_info},a=this.makeRequest("auth/user/checkToken/",i),o=a.success?!0:!1}return o},this.get_request_token=function(){return this.token},this.makeRequest=function(e,t){sdk_app_context.showLoader();var i={};return $.ajax({type:"POST",headers:t.headers,url:window.api_base_url+e,data:JSON.stringify(t.data),dataType:"json",async:!1}).done(function(e){i=e,sdk_app_context.hideLoader()}).fail(function(e){i=!1,console.log(JSON.stringify(e))}),i},this.patchRequest=function(e,t){console.log("----------------------------"),console.log(t.data),console.log("----------------------------"),sdk_app_context.showLoader();var i={};return $.ajax({type:"PATCH",headers:t.headers,url:window.api_base_url+e,data:t.data,dataType:"json",async:!1}).done(function(e){i=e,sdk_app_context.hideLoader(e)}).fail(function(e){i=!1,console.log(JSON.stringify(e))}),i},this.makePatch2Request=function(e,t){console.log("----------------------------"),console.log(t.data),console.log("----------------------------"),sdk_app_context.showLoader();var i={};return $.ajax({type:"PATCH",headers:t.headers,url:window.api_base_url+e,data:JSON.stringify(t.data),dataType:"json",async:!1}).done(function(e){i=e,sdk_app_context.hideLoader(e)}).fail(function(e){i=!1,console.log(JSON.stringify(e))}),i},this.deleteRequest=function(e,t){console.log(t.data),sdk_app_context.showLoader();var i={};return console.log("datos"+t.data),$.ajax({type:"DELETE",headers:t.headers,url:window.api_base_url+e,data:JSON.stringify(t.data),dataType:"json",async:!1}).done(function(e){i=e,sdk_app_context.hideLoader(e)}).fail(function(e){i=!1,console.log(JSON.stringify(e)),$(".overscreen_err").is(":visible")?($(".overscreen_err").removeClass("active"),setTimeout(function(){$(".overscreen_err").hide()},800)):(console.log("entra popup"),$(".overscreen_err").show(),setTimeout(function(){$(".overscreen_err").addClass("active")},200)),$("#blur").toggleClass("blurred"),$("#aceptar_err").click(function(){$(".overscreen_err").hide(),$("#blur").toggleClass("blurred")})}),i},this.makeCopyDietReques=function(e,t){console.log(t.data),sdk_app_context.showLoader();var i={};return console.log("datos"+t.data),$.ajax({type:"POST",headers:t.headers,url:window.api_base_url+e,data:JSON.stringify(t.data),dataType:"json"}).done(function(e){i=e,sdk_app_context.hideLoader(e)}).fail(function(e){i=!1,console.log(JSON.stringify(e))}),i},this.getRequest=function(e,t){console.log("One request"),sdk_app_context.showLoader();var i=t?JSON.stringify(t):"",a={};return $.ajax({type:"GET",headers:apiRH.headers,url:window.api_base_url+e,data:i,dataType:"json",async:!1}).done(function(e){a=e}).fail(function(e){a=!1,console.log(JSON.stringify(e))}),a},this.putRequest=function(e,t){sdk_app_context.showLoader();var i={};return $.ajax({type:"PUT",data:$.param(t),contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:window.api_base_url+e}).done(function(e){i=e,sdk_app_context.hideLoader()}).fail(function(e){i=!1,console.log(e)}),i},this.patchRequest=function(e,t){sdk_app_context.showLoader();var i={},a=new XMLHttpRequest;return a.open("POST",window.api_base_url+e),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.onload=function(){if(console.log(a.status),200===a.status){var e=JSON.parse(a.responseText);console.log(e),sdk_app_context.hideLoader()}},a.send(t),i},this.loginOauth=function(e,t){sdk_app_context.showLoader(),OAuth.popup(e).done(t).fail(function(e){console.log(e)})},this.loginCallbackGP=function(t){t.me().done(function(t){console.log(t);var i=t.email,a=t.lastname+"_"+t.id;apiRH.create_internal_user(a,i,{gpId:t.id,avatar:t.avatar,name:t.firstname,last_name:t.lastname},window.apiRH.keeper.getItem("request_token"));e.endHandshake(a),window.location.assign("feed.html?filter_feed=all")}).fail(function(e){console.log(e)})},this.loginCallbackFB=function(t){t.me().done(function(t){console.log(t);var i=t.email,a=t.lastname+"_"+t.id;apiRH.create_internal_user(a,i,{fbId:t.id,avatar:t.avatar,name:t.firstname,last_name:t.lastname},window.apiRH.keeper.getItem("request_token"));e.endHandshake(a),window.location.assign("feed.html?filter_feed=all")}).fail(function(e){console.log(e)})},this.addImageToStack=function(e){console.log(JSON.stringify(e)),$(".close_on_touch").trigger("click");var t=Handlebars.templates.stackImage,i=t(e);$(".insert_here").append(i)},this.endHandshake=function(t){var i=e.getRequest("user/exists/"+t,null);i.success&&(data={user_id:"none",token:apiRH.get_request_token(),validate_id:i.data.user_id?i.data.user_id:"none"},response=this.makeRequest("user/validateToken/",data),e.save_user_data_clientside(i.data))},this.transfer_win=function(e){app.toast("Se ha publicado una imagen"),window.location.reload(!0)},this.profile_transfer_win=function(e){return!0},this.receipt_transfer_win=function(e){setTimeout(function(){return app.toast("Tu recibo se ha subido correctamente."),setTimeout(function(){app.hideLoader()},2e3),!0},0)},this.transfer_fail=function(e){setTimeout(function(){console.log(JSON.stringify(e)),alert("An error has occurred: Code = "+e.code),console.log("upload error source "+e.source),console.log("upload error target "+e.target)},0)},this.prepareProfileFileTransfer=function(e){app.showLoader(),this.transfer_options=new FileUploadOptions,this.transfer_options.fileUrl=e,this.transfer_options.fileKey="file",this.transfer_options.fileName=e.substr(e.lastIndexOf("/")+1),this.transfer_options.mimeType="image/jpeg",console.log(this.transfer_options);var t={};t.client="app",this.transfer_options.params=t,this.upload_ready=!0,console.log("prepareProfileTransfer"),app.hideLoader()},this.initializeProfileFileTransfer=function(){if(this.upload_ready){var t=new FileTransfer;t.upload(this.transfer_options.fileUrl,encodeURI(api_base_url+"transfers/"+user+"/profile/"),e.profile_transfer_win,e.transfer_fail,this.transfer_options)}},this.prepareReceiptFileTransfer=function(e,t){app.showLoader(),console.log(e),this.transfer_options=new FileUploadOptions,this.transfer_options.fileUrl=e,this.transfer_options.fileLocal="file://"+e,this.transfer_options.fileKey="file",this.transfer_options.fileName=e.substr(e.lastIndexOf("/")+1),this.transfer_options.httpMethod="POST",this.transfer_options.mimeType="image/jpeg",this.transfer_options.quality=50,this.transfer_options.correctOrientation=!0,this.transfer_options.chunkedMode=!1,console.log(this.transfer_options);var i={};i.client="app",this.transfer_options.params=i,this.upload_ready=!0;var a={thumb:this.transfer_options.fileLocal};console.log(JSON.stringify(a)),apiRH.initializeReceiptFileTransfer(),console.log("prepareReceiptTransfer"),app.hideLoader()},this.initializeReceiptFileTransfer=function(t){_coach?_coach:"not_logged";if(this.upload_ready){var i=new FileTransfer;this.transfer_options.params=t,i.upload(this.transfer_options.fileUrl,encodeURI("http://ginger-admin.cloudapp.net/rogue1.php"),e.receipt_transfer_win,e.transfer_fail,this.transfer_options),app.showLoader(),app.toast("Estamos procesando tu recibo...")}},this.fileselect_win=function(t){return t||""!=t?e.prepareProfileFileTransfer(t):void 0},this.receipt_fileselect_win=function(t){setTimeout(function(){return console.log("r ::: "+t),console.log("Receipt file sent"),t||""!=t?e.prepareReceiptFileTransfer(t):void 0},0)},this.profileselect_win=function(t){return t||""!=t?void 0:e.prepareProfileFileTransfer(t)},this.fileselect_fail=function(e){app.toast("An error has occurred: "+e)},this.getFileFromDevice=function(t,i){this.photoDestinationType=navigator.camera.DestinationType;var a=navigator.camera.PictureSourceType.PHOTOLIBRARY;"camera"==i&&(a=navigator.camera.PictureSourceType.CAMERA),"profile"==t&&navigator.camera.getPicture(e.profileselect_win,e.fileselect_fail,{quality:50,destinationType:this.photoDestinationType.FILE_URI,sourceType:a,mediaType:navigator.camera.MediaType.ALLMEDIA}),"receipt"==t&&navigator.camera.getPicture(e.receipt_fileselect_win,e.fileselect_fail,{quality:100,destinationType:this.photoDestinationType.FILE_URI,sourceType:a,mediaType:navigator.camera.MediaType.ALLMEDIA})},this.fetchCoachProfile=function(){for(var e=5,t={stars:{active:0,inactive:0}},i="",a=Math.round(_coach.rating),o="",n=0;a>n;n++)t.stars.active++,i+="<img src='"+cordova_full_path+"images/starh.svg'>";for(var s=0;e-a>s;s++)t.stars.inactive++,i+="<img src='"+cordova_full_path+"images/star.svg'>";for(var r="",l=0;l<_coach.personalidad.length;l++)r=l==_coach.personalidad.length-1?"":", ",o+=catalogues.coach_type[l]+r;return t.stars.html=i,t.personalidad_concat=o,t},this.fetchClientProfile=function(e){console.log("Fetch client profile");apiRH.getRequest("tables/cliente?_id="+e)},this.postNotification=function(e,t,i,a){console.log("Posting a notification"),window.plugins.OneSignal.getIds(function(e){var t={contents:{en:"message body"},include_player_ids:[e.userId]};window.plugins.OneSignal.postNotification(t,function(e){console.log("Notification Post Success:",e)},function(e){console.log("Notification Post Failed: ",e),alert("Notification Post Failed:\n"+JSON.stringify(e))})})}}